# Кастом ТК302-ФБ (Custom TK302-FB Printer)

[Описание устройства на официальном сайте производителя](https://ladon.ru/kontrolno-kassovaya-tekhnika-kkt/kkt-custom-tk302-fb-ispolnenie-2/)


## Запросы

### Издать звуковой сигнал

`POST /api/beep`

### Получить статус ККТ

`GET /api/status`

### Открыть смену

`POST /api/shift/open`

### Закрыть кассовую смену

`POST /api/shift/close`

### Напечатать чек

`POST /api/print/receipt`

### Напечатать чек возврата

`POST /api/print/receipt/return`

### Напечатать слип-чек

`POST /api/print/slip`

### Напечатать билет

`POST /api/print/ticket`

### Напечатать x-отчет

`POST /api/print/report/x`


## Установка

Инструкция по установке на сервере Windows. Проверено на свежеустановленном Windows Server 2016 Standart (1607) x64. Параметрамы конфигурации: 2x2.2ГГц, 2Гб RAM, 30Гб HDD.

1. В Диспетчере Серверов добавить роль "Веб-сервер (IIS)" ([скриншот](Source/Images/s01.jpg)), при установке все настройки оставить по умолчанию.

2. Скачать и установить среду выполнения - [ASP.NET Core 3.1 Runtime](https://dotnet.microsoft.com/download/dotnet/thank-you/runtime-aspnetcore-3.1.21-windows-hosting-bundle-installer). После установки перезагрузить сервер.

3. [Скачать]() последнюю актуальную версию приложения и разместить разархивированную папку с приложением на сервере, например, по адресу `C:\inetpub\TK302FBPrinter`.

4. В Диспетчере служб IIS остановить созданный по умолчанию веб-сайт "Default Web Site" (кнопкой "Остановить" на правой панели) и создать новый веб-сайт ([скриншот](Source/Images/s02.jpg)). При создании указать настройки, как показано на [скриншоте](Source/Images/s03.jpg). Запустить созданный веб-сайт.

5. Проверить работу сервиса, открыв с браузере адрес `http://localhost/`. При этом должна появиться страница с текстом `TK302-FB Printer Service is running...`.

6. Так же проверить работу сервиса можно при помощи одной из утилит для отправки http-запросов, например, [Postman](https://www.postman.com). Для проверки сервиса в режиме эмуляции (то есть без необходимости подключения к устройству - принтеру) в файле `appsettings.json` указать значние `true` для параметра `EmulationMode`.

7. Для корректной работы приложения с реальным устройством на сервере должен быть установлен [драйвер](https://ladon.ru/upload/iblock/fd6/custom_tk302_fb_driver_v.2.30.00.zip) (для проверки в режиме эмуляции драйвер не нужен).
